<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ymcbot Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* GENEL AYARLAR */
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #0a0a0a; color: white; margin: 0; padding: 10px; overflow-x: hidden; }
        
        /* BAŞLIK - BEYAZ VE SADE */
        .main-title { text-align: center; margin: 5px 0 15px 0; font-size: 22px; font-weight: bold; color: #ffffff; }

        /* ÜST PANEL (SAATLER & MOD) */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border: 1px solid #333; padding: 8px; border-radius: 10px; background: #141414; }
        .clocks { display: flex; gap: 8px; }
        .clock-box { background: #000; padding: 4px 8px; border-radius: 6px; border: 1px solid #444; text-align: center; min-width: 75px; }
        .clock-label { font-size: 8px; color: #888; text-transform: uppercase; display: block; }
        .clock-time { font-family: monospace; font-size: 13px; font-weight: bold; color: #eee; }

        .bot-mode { display: flex; align-items: center; gap: 8px; font-size: 12px; font-weight: bold; padding-right: 5px; }
        
        /* PİYASA ROZETİ STİLİ */
        .market-badge {
            padding: 3px 6px;
            border-radius: 5px;
            font-size: 10px;
            text-transform: uppercase;
            border: 1px solid #444;
            background: #000;
        }

        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
        .status-on { background: #2ecc71; box-shadow: 0 0 8px #2ecc71; }
        .status-sleep { background: #f1c40f; }
        .status-error { background: #e74c3c; }

        /* VERİ KUTULARI (GRID) */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 10px; }
        .stat-card { background: #141414; border: 1px solid #333; padding: 10px 5px; border-radius: 10px; text-align: center; }
        .stat-label { color: #888; font-size: 10px; margin-bottom: 5px; white-space: nowrap; }
        .stat-value { font-size: 15px; font-weight: bold; color: #fff; }

        /* GRAFİK */
        .chart-container { background: #141414; border: 1px solid #333; padding: 10px; border-radius: 10px; height: 280px; width: 100%; }
        
        .last-msg { margin-top: 10px; color: #555; font-size: 11px; text-align: center; font-style: italic; }

        /* MOBİL ÖZEL OPTİMİZASYON */
        @media (max-width: 600px) {
            .main-title { font-size: 18px; margin-bottom: 10px; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .header { padding: 6px; flex-direction: column; gap: 10px; }
            .bot-mode { width: 100%; justify-content: center; border-top: 1px solid #222; pt: 5px; }
            .clock-box { min-width: 65px; }
            .clock-time { font-size: 11px; }
            .stat-value { font-size: 14px; }
            .chart-container { height: 240px; }
        }
    </style>
</head>
<body>

    <div class="main-title">Ymcbot Dashboard</div>

    <div class="header">
        <div class="clocks">
            <div class="clock-box">
                <span class="clock-label">Istanbul</span>
                <span id="ist-clock" class="clock-time">00:00:00</span>
            </div>
            <div class="clock-box">
                <span class="clock-label">New York</span>
                <span id="ny-clock" class="clock-time">00:00:00</span>
            </div>
        </div>
        <div class="bot-mode">
            <div id="market-badge" class="market-badge">PİYASA: <span id="market-text">...</span></div>
            
            <span id="mode-dot" class="status-dot"></span>
            MODE: <span id="mode-text">YÜKLENİYOR</span>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">Bakiye</div>
            <div id="balance" class="stat-value">-</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">İşlem Sayısı</div>
            <div id="trades" class="stat-value">-</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Pozisyon</div>
            <div id="pos" class="stat-value">-</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Toplam P/L</div>
            <div id="pnl" class="stat-value">-</div>
        </div>
    </div>

    <div class="chart-container">
        <canvas id="equityChart"></canvas>
    </div>

    <div id="msg" class="last-msg">Sistem hazır...</div>

    <script>
        let myChart;

        function updateClocks() {
            const options = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            document.getElementById('ist-clock').innerText = new Date().toLocaleString('tr-TR', { ...options, timeZone: 'Europe/Istanbul' });
            document.getElementById('ny-clock').innerText = new Date().toLocaleString('tr-TR', { ...options, timeZone: 'America/New_York' });
        }
        setInterval(updateClocks, 1000);

        async function fetchData() {
            try {
                const res = await fetch('status.json?t=' + new Date().getTime());
                const data = await res.json();

                document.getElementById('balance').innerText = data.balance;
                document.getElementById('trades').innerText = data.total_trades;
                document.getElementById('pos').innerText = data.position;
                document.getElementById('pnl').innerText = data.total_pnl;
                document.getElementById('msg').innerText = data.last_update + " | " + data.message;
                
                document.getElementById('pnl').style.color = data.total_pnl.includes('+') ? '#2ecc71' : '#e74c3c';

                // PİYASA DURUMU GÜNCELLEME
                const marketText = data.market_open || "KAPALI";
                const marketBadge = document.getElementById('market-badge');
                document.getElementById('market-text').innerText = marketText;
                
                if(marketText === "AÇIK") {
                    marketBadge.style.borderColor = "#2ecc71";
                    marketBadge.style.color = "#2ecc71";
                } else {
                    marketBadge.style.borderColor = "#e74c3c";
                    marketBadge.style.color = "#e74c3c";
                }

                const modeText = data.bot_status.toUpperCase();
                document.getElementById('mode-text').innerText = modeText;
                const dot = document.getElementById('mode-dot');
                dot.className = 'status-dot';
                if(modeText.includes('ON')) dot.classList.add('status-on');
                else if(modeText.includes('SLEEP')) dot.classList.add('status-sleep');
                else dot.classList.add('status-error');

                if(data.equity_history) updateChart(data.equity_history);

            } catch (e) { console.log("Veri bekleniyor..."); }
        }

        function updateChart(history) {
            const labels = history.map(h => h.time);
            const values = history.map(h => h.val);

            if (myChart) {
                myChart.data.labels = labels;
                myChart.data.datasets[0].data = values;
                myChart.update();
            } else {
                const ctx = document.getElementById('equityChart').getContext('2d');
                myChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: values,
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            pointRadius: 1,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { grid: { color: '#222' }, ticks: { color: '#555', font: { size: 9 } } },
                            x: { grid: { display: false }, ticks: { color: '#555', font: { size: 9 } } }
                        }
                    }
                });
            }
        }

        setInterval(fetchData, 10000);
        fetchData();
        updateClocks();
    </script>
</body>
</html>
